# ============================================================================
# COMPLETE .ENV CONFIGURATION FOR STORAGE MODE
# ============================================================================
# This is the complete configuration combining:
# 1. Original RAG indexer settings
# 2. NEW Storage mode settings
# ============================================================================

# ============================================================================
# ðŸ†• SUPABASE STORAGE CONFIGURATION (NEW)
# ============================================================================

# Supabase project URL and service role key
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# Storage bucket name
SUPABASE_STORAGE_BUCKET=vehicle-documents

# Temporary directory for downloading files from Storage
STORAGE_TEMP_DIR=/tmp/rag_storage_temp

# Storage path prefixes (optional, defaults shown)
STORAGE_PENDING_PREFIX=raw/pending/
STORAGE_PROCESSED_PREFIX=raw/processed/
STORAGE_FAILED_PREFIX=raw/failed/

# ============================================================================
# DATABASE SETTINGS
# ============================================================================

# Supabase PostgreSQL connection string
SUPABASE_CONNECTION_STRING=postgresql://postgres:[password]@db.[project-ref].supabase.co:5432/postgres

# Vector database table name
TABLE_NAME=documents

# ============================================================================
# INPUT DIRECTORY (Markdown files from Docling)
# ============================================================================
DOCUMENTS_DIR=./data/markdown

# ============================================================================
# GOOGLE GEMINI API SETTINGS
# ============================================================================
GEMINI_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Embedding model settings - Google Gemini embeddings
EMBED_MODEL=text-embedding-004
EMBED_DIM=768                  # gemini supports 768, 1536, or 3072 dimensions

# ============================================================================
# TEXT CHUNKING SETTINGS
# ============================================================================
CHUNK_SIZE=512                 # Characters per chunk (for SentenceSplitter fallback)
CHUNK_OVERLAP=128              # Overlap between chunks (for SentenceSplitter fallback)
MIN_CHUNK_LENGTH=50            # Minimum chunk length to keep

# ============================================================================
# HYBRID CHUNKING SETTINGS (Docling HybridChunker)
# ============================================================================
USE_HYBRID_CHUNKING=true       # Enable Docling HybridChunker (structure-aware chunking)
HYBRID_MAX_TOKENS=512          # Max tokens per chunk (matching CHUNK_SIZE for consistency)
HYBRID_MERGE_PEERS=true        # Merge sibling paragraphs in same section
HYBRID_USE_CONTEXTUALIZE=false # Add heading hierarchy to chunk content (can enable later)

# Tokenizer settings for HybridChunker
HYBRID_TOKENIZER=huggingface   # Options: huggingface, openai
HYBRID_TOKENIZER_MODEL=sentence-transformers/all-MiniLM-L6-v2  # HuggingFace tokenizer model (free, offline after first download)

# ============================================================================
# BATCH PROCESSING SETTINGS
# ============================================================================
PROCESSING_BATCH_SIZE=50       # Chunks per processing batch
BATCH_SIZE=5                   # Chunks per embedding batch
DB_BATCH_SIZE=200              # Records per database batch
NUM_WORKERS=4                  # Parallel workers

# ============================================================================
# GEMINI API OPTIMIZATION
# ============================================================================
GEMINI_TIMEOUT=300             # API timeout in seconds
GEMINI_REQUEST_RATE_LIMIT=10  # Requests per second
GEMINI_RETRY_ATTEMPTS=3       # Number of retries for failed requests
GEMINI_RETRY_DELAY=1.0         # Delay between retries in seconds
GEMINI_MAX_TOKENS_PER_REQUEST=2048

# ============================================================================
# MONITORING AND LOGGING
# ============================================================================
ENABLE_PROGRESS_LOGGING=true
LOG_BATCH_TIMING=true
LOG_GEMINI_API_CALLS=false

# ============================================================================
# DIRECTORY FILTERING (Optional - exclude these from scanning)
# ============================================================================
BLACKLIST_DIRECTORIES=logs,temp,.git,__pycache__,.vscode,.idea,node_modules,_metadata

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================
SKIP_VALIDATION=false

# ============================================================================
# DOCLING - DOCUMENT CONVERSION SETTINGS
# ============================================================================

# ðŸ”„ LEGACY: Local filesystem directories (optional for Storage mode)
RAW_DOCUMENTS_DIR=./data/raw
MARKDOWN_OUTPUT_DIR=./data/markdown
FAILED_CONVERSIONS_DIR=./data/failed
METADATA_DIR=./data/markdown/_metadata

# Supported formats (comma-separated)
SUPPORTED_FORMATS=pdf,docx,doc,pptx,ppt,txt,html,htm,png,jpg,jpeg,tiff

# Conversion settings
RECURSIVE_SCAN=true
MIRROR_DIRECTORY_STRUCTURE=true
PRESERVE_IMAGES=false
EXTRACT_TABLES=true

# JSON output for Hybrid Chunking (saves DoclingDocument JSON alongside markdown)
SAVE_JSON_OUTPUT=true
JSON_OUTPUT_DIR=./data/json

# OCR settings
ENABLE_OCR=true
OCR_LANGUAGE=eng

# Naming: timestamp_originalname.md
USE_TIMESTAMP_PREFIX=false
TIMESTAMP_FORMAT=%Y%m%d_%H%M%S

# Error handling
SKIP_FAILED_CONVERSIONS=true
RETRY_FAILED=false
MAX_RETRIES=2

# Performance
DOCLING_BATCH_SIZE=5
USE_GPU=false
MAX_FILE_SIZE_MB=100

# Logging
VERBOSE_LOGGING=true
LOG_DIR=./logs

# ============================================================================
# INCREMENTAL MODE (for indexing only)
# ============================================================================
# Enable incremental indexing (skip already processed files)
INCREMENTAL_MODE=true

# ============================================================================
# NOTES
# ============================================================================
# This configuration supports BOTH modes:
#
# 1. STORAGE MODE (Recommended):
#    - Set SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY, SUPABASE_STORAGE_BUCKET
#    - Use: python scripts/upload_documents.py --dir /path/to/docs
#    - Use: python process_documents_storage.py
#    - Files stored in Supabase Storage
#
# 2. FILESYSTEM MODE (Legacy):
#    - Set RAW_DOCUMENTS_DIR to local directory
#    - Use: python process_documents.py
#    - Files stored locally
#
# Prerequisites:
# - Supabase project with Storage bucket created
# - GEMINI_API_KEY from https://makersuite.google.com/app/apikey
# - Database schema applied (run SQL from README.md)
#
# Quick Start:
# 1. Copy this file: cp .env.storage.example .env
# 2. Fill in your Supabase credentials
# 3. Run: python scripts/setup_storage.py
# 4. Run SQL schema from README.md
# 5. Upload docs: python scripts/upload_documents.py --dir /path
# 6. Process: python process_documents_storage.py
# ============================================================================
