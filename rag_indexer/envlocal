# ============================================================================
# COMPLETE .ENV CONFIGURATION
# ============================================================================
# This configuration supports BOTH Storage mode (new) and Filesystem mode (legacy)
# ============================================================================

# ============================================================================
# ðŸ†• SUPABASE STORAGE CONFIGURATION (NEW - for Storage mode)
# ============================================================================

# Supabase project URL and service role key
SUPABASE_URL=https://xzchopxzxkesqkoonumj.supabase.co
SUPABASE_SERVICE_ROLE_KEY=
# Storage bucket name
SUPABASE_STORAGE_BUCKET=vehicle-documents

# Temporary directory for downloading files from Storage
STORAGE_TEMP_DIR=/tmp/rag_storage_temp

# Storage path prefixes (optional, defaults shown)
STORAGE_PENDING_PREFIX=raw/pending/
STORAGE_PROCESSED_PREFIX=raw/processed/
STORAGE_FAILED_PREFIX=raw/failed/

# ============================================================================
# DATABASE SETTINGS
# ============================================================================
SUPABASE_CONNECTION_STRING=""
TABLE_NAME=documents

# ============================================================================
# INPUT DIRECTORY (Markdown files from Docling)
# ============================================================================
DOCUMENTS_DIR=./data/markdown

# ============================================================================
# GOOGLE GEMINI API SETTINGS
# ============================================================================
GEMINI_API_KEY=

# Embedding model settings - Google Gemini embeddings
EMBED_MODEL=text-embedding-004
EMBED_DIM=768                  # gemini supports 768, 1536, or 3072 dimensions

# ============================================================================
# TEXT CHUNKING SETTINGS
# ============================================================================
CHUNK_SIZE=512                 # Characters per chunk (for SentenceSplitter fallback)
CHUNK_OVERLAP=128              # Overlap between chunks (for SentenceSplitter fallback)
MIN_CHUNK_LENGTH=50            # Minimum chunk length to keep

# ============================================================================
# HYBRID CHUNKING SETTINGS (Docling HybridChunker)
# ============================================================================
USE_HYBRID_CHUNKING=true       # Enable Docling HybridChunker (structure-aware chunking)
HYBRID_MAX_TOKENS=512          # Max tokens per chunk (matching CHUNK_SIZE for consistency)
HYBRID_MERGE_PEERS=true        # Merge sibling paragraphs in same section
HYBRID_USE_CONTEXTUALIZE=true # Add heading hierarchy to chunk content (ENABLED for better RAG quality)

# Tokenizer settings for HybridChunker
HYBRID_TOKENIZER=huggingface   # Options: huggingface, openai
HYBRID_TOKENIZER_MODEL=sentence-transformers/all-MiniLM-L6-v2  # HuggingFace tokenizer model (free, offline after first download)

# ============================================================================
# BATCH PROCESSING SETTINGS
# ============================================================================
PROCESSING_BATCH_SIZE=50       # Chunks per processing batch
BATCH_SIZE=5                   # Chunks per embedding batch
DB_BATCH_SIZE=200              # Records per database batch
NUM_WORKERS=4                  # Parallel workers

# ============================================================================
# GEMINI API OPTIMIZATION
# ============================================================================
GEMINI_TIMEOUT=300             # API timeout in seconds
GEMINI_REQUEST_RATE_LIMIT=10  # Requests per second
GEMINI_RETRY_ATTEMPTS=3       # Number of retries for failed requests
GEMINI_RETRY_DELAY=1.0         # Delay between retries in seconds
GEMINI_MAX_TOKENS_PER_REQUEST=2048

# ============================================================================
# MONITORING AND LOGGING
# ============================================================================
ENABLE_PROGRESS_LOGGING=true
LOG_BATCH_TIMING=true
LOG_GEMINI_API_CALLS=false

# ============================================================================
# DIRECTORY FILTERING (Optional - exclude these from scanning)
# ============================================================================
BLACKLIST_DIRECTORIES=logs,temp,.git,__pycache__,.vscode,.idea,node_modules,_metadata

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================
SKIP_VALIDATION=false

# ============================================================================
# NOTES
# ============================================================================
# This configuration supports BOTH modes:
#
# 1. STORAGE MODE (Recommended - NEW):
#    - Uses Supabase Storage for raw documents
#    - Upload: python scripts/upload_documents.py --dir /path/to/docs
#    - Process: python process_documents_storage.py
#    - Index: python indexer.py
#
# 2. FILESYSTEM MODE (Legacy):
#    - Uses RAW_DOCUMENTS_DIR for local files
#    - Process: python process_documents.py
#    - Index: python indexer.py
#
# Quick Start (Storage Mode):
# 1. Run: python scripts/setup_storage.py (creates bucket)
# 2. Run SQL schema from ../README.md in Supabase SQL Editor
# 3. Upload: python scripts/upload_documents.py --dir /path/to/docs
# 4. Process: python process_documents_storage.py
# 5. Index: python indexer.py
#
# Prerequisites:
# - Supabase project with Storage enabled
# - GEMINI_API_KEY from https://makersuite.google.com/app/apikey
# - Database schema applied (run SQL from README.md)
# ============================================================================
# DOCLING - DOCUMENT CONVERSION SETTINGS
# ============================================================================
RAW_DOCUMENTS_DIR=c:/projects/aidocsbackend/rag_indexer/data/raw_test
MARKDOWN_OUTPUT_DIR=c:/projects/aidocsbackend/rag_indexer/data/markdown
FAILED_CONVERSIONS_DIR=c:/projects/aidocsbackend/rag_indexer/data/failed
METADATA_DIR=c:/projects/aidocsbackend/rag_indexer/data/markdown/_metadata

# Supported formats (comma-separated)
SUPPORTED_FORMATS=pdf,docx,doc,pptx,ppt,txt,html,htm,png,jpg,jpeg,tiff

# Conversion settings
RECURSIVE_SCAN=true
MIRROR_DIRECTORY_STRUCTURE=true
PRESERVE_IMAGES=false
EXTRACT_TABLES=true

# JSON output for Hybrid Chunking (saves DoclingDocument JSON alongside markdown)
SAVE_JSON_OUTPUT=true
JSON_OUTPUT_DIR=c:/projects/aidocsbackend/rag_indexer/data/json

# OCR settings
ENABLE_OCR=true
OCR_LANGUAGE=eng

# Naming: timestamp_originalname.md
USE_TIMESTAMP_PREFIX=false
TIMESTAMP_FORMAT=%Y%m%d_%H%M%S

# Error handling
SKIP_FAILED_CONVERSIONS=true
RETRY_FAILED=false
MAX_RETRIES=2

# Performance
DOCLING_BATCH_SIZE=5
USE_GPU=false
MAX_FILE_SIZE_MB=100

# Logging
VERBOSE_LOGGING=true
LOG_DIR=./logs

# ============================================================================
# INCREMENTAL MODE (for indexing only)
# ============================================================================
INCREMENTAL_MODE=true
# ðŸ†• GEMINI VISION API SETTINGS (for fast OCR via Docling)
# Enable Gemini Vision API for picture description (replaces slow EasyOCR)
USE_GEMINI_VISION=true

# Gemini API key (same as used for embeddings)
# Already set above: GEMINI_API_KEY=your-key-here

# Vision model (fast and accurate)
GEMINI_VISION_MODEL=gemini-2.0-flash-exp

# Timeout for vision API calls (in seconds)
GEMINI_VISION_TIMEOUT=30

# Prompt for text extraction from images
GEMINI_VISION_PROMPT=Extract all text from this document image. Preserve formatting, tables, and structure. Be accurate and complete.
