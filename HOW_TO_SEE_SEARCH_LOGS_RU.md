# –ö–∞–∫ —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏ –ø–æ–∏—Å–∫–∞ (–†–ï–®–ï–ù–ò–ï)

## –ü—Ä–æ–±–ª–µ–º–∞

–í—ã –≤–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ API, –Ω–æ –Ω–µ –≤–∏–¥–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ.

## –ü—Ä–∏—á–∏–Ω–∞

–ö–æ–≥–¥–∞ –≤—ã –¥–µ–ª–∞–µ—Ç–µ –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –ª–æ–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è **–í –ö–û–ù–°–û–õ–ò –ì–î–ï –ó–ê–ü–£–©–ï–ù API**, –Ω–æ –∏—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –≤–∏–¥–Ω–æ –∏–∑-–∑–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–æ–∫ watchfiles.

## –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π API

–í –∫–æ–Ω—Å–æ–ª–∏ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω API, –Ω–∞–∂–º–∏—Ç–µ:
```
Ctrl+C
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ API –ë–ï–ó auto-reload

–í–º–µ—Å—Ç–æ `python run_api.py` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
python run_api_no_reload.py
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç API **–±–µ–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å –≤—Å–µ –ª–æ–≥–∏ —á–µ—Ç–∫–æ.

### –®–∞–≥ 3: –î–æ–∂–¥–∏—Ç–µ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

–í—ã —É–≤–∏–¥–∏—Ç–µ:
```
INFO:     Started server process [12345]
INFO:     Waiting for application startup.
2025-10-23 15:XX:XX,XXX - INFO - api.main - üöÄ Starting Document Intelligence Platform API...
...
INFO:     Application startup complete.
```

### –®–∞–≥ 4: –°–¥–µ–ª–∞–π—Ç–µ –ø–æ–∏—Å–∫

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ª—é–±–æ–π –ø–æ–∏—Å–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "231-D-54321").

### –®–∞–≥ 5: –ù–ï–ú–ï–î–õ–ï–ù–ù–û –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –∫ –∫–æ–Ω—Å–æ–ª–∏ API

–í –∫–æ–Ω—Å–æ–ª–∏ –í–´ –£–í–ò–î–ò–¢–ï –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏:

```
================================================================================
SEARCH REQUEST: query='231-D-54321', top_k=10
================================================================================

STAGE 0: Query Preprocessing
----------------------------------------
[+] Query preprocessed: '231-D-54321' -> '231-D-54321'
    Method: PASS
    Time: 0.001s

STAGE 1: Multi-Strategy Retrieval
----------------------------------------
[+] Retrieved 6 candidates
    Methods: database_hybrid, vector_smart_threshold
    Time: 1.847s
    Result sources breakdown:
      - database_hybrid: 3 results
      - vector_smart_threshold: 3 results

STAGE 2: Hybrid Results Fusion + LLM Re-ranking
----------------------------------------
[+] Fused to 3 documents
    Fusion method: database_priority
    Time: 2.120s
    Top 3 results:
      [1] CVRT Pass Statement.md
          Base score: 0.650, LLM: 10.0, Match: exact_phrase
      [2] Vehicle Registration Certificate.md
          Base score: 0.650, LLM: 10.0, Match: exact_phrase
      [3] VCR.md
          Base score: 0.650, LLM: 10.0, Match: exact_phrase

STAGE 3: Format Response
----------------------------------------

================================================================================
SEARCH COMPLETED
================================================================================
Total Time: 3.289s
Results returned: 3
Time breakdown:
  - Preprocessing: 0.001s
  - Retrieval: 1.847s
  - Fusion: 2.120s
Final scores (what user sees):
  [1] CVRT Pass Statement.md: 100.0%
  [2] Vehicle Registration Certificate.md: 100.0%
  [3] VCR.md: 100.0%
================================================================================

INFO:     192.168.1.100:54321 - "POST /api/search/ HTTP/1.1" 200 OK
```

## –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ

### STAGE 0: Query Preprocessing
- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
- –ú–µ—Ç–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (PASS, CLEANED, AI_ENHANCED, REJECTED)
- –£–¥–∞–ª–µ–Ω–Ω—ã–µ stop words (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### STAGE 1: Multi-Strategy Retrieval
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã (database_hybrid, vector_smart_threshold)
- –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º (—Å–∫–æ–ª—å–∫–æ –æ—Ç database, —Å–∫–æ–ª—å–∫–æ –æ—Ç vector)
- –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞

### STAGE 2: Hybrid Results Fusion + LLM Re-ranking
- –ú–µ—Ç–æ–¥ fusion (database_priority, hybrid_weighted, etc.)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ—Å–ª–µ deduplic ation –∏ fusion
- –¢–æ–ø-3 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–∫–æ—Ä–∞–º–∏:
  - **Base score**: –±–∞–∑–æ–≤—ã–π —Å–∫–æ—Ä (0.65 –¥–ª—è database)
  - **LLM score**: –æ—Ü–µ–Ω–∫–∞ Gemini 0-10 (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10.0)
  - **Match type**: —Ç–∏–ø —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (exact_phrase, strong_match, etc.)
- –í—Ä–µ–º—è fusion + re-ranking

### STAGE 3: Format Response
- –§–∏–Ω–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –†–∞–∑–±–∏–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ —ç—Ç–∞–ø–∞–º
- **–§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∫–æ—Ä—ã —á—Ç–æ –≤–∏–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** (—É–ª—É—á—à–µ–Ω–Ω—ã–µ!)
  - –ù–∞–ø—Ä–∏–º–µ—Ä: 100.0% –≤–º–µ—Å—Ç–æ 65.0%

## –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏

### 1. –õ–æ–≥–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –í –†–ï–ê–õ–¨–ù–û–ú –í–†–ï–ú–ï–ù–ò

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –ø–æ–∏—Å–∫ –≤ –±—Ä–∞—É–∑–µ—Ä–µ ‚Üí –ª–æ–≥–∏ –°–†–ê–ó–£ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª–∏ API.

### 2. –ö–∞–∂–¥—ã–π –ø–æ–∏—Å–∫ = –Ω–æ–≤—ã–π –±–ª–æ–∫ –ª–æ–≥–æ–≤

–ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å:
```
================================================================================
SEARCH REQUEST: query='...'
================================================================================
```

### 3. Emoji –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ ASCII

–í—Å–µ —Å–∏–º–≤–æ–ª—ã ASCII:
- [+] - —É—Å–ø–µ—Ö/–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
- [-] - –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ
- [!] - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- [*] - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å API)

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –∑–∞–ø—É—â–µ–Ω API —Å reload, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥ —á—Ç–æ–±—ã watchfiles —É—Å–ø–æ–∫–æ–∏–ª—Å—è, –∑–∞—Ç–µ–º —Å–¥–µ–ª–∞–π—Ç–µ –ø–æ–∏—Å–∫ –∏ –°–†–ê–ó–£ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å.

## –ï—Å–ª–∏ –°–û–í–°–ï–ú –Ω–µ –≤–∏–¥–∏—Ç–µ –ª–æ–≥–æ–≤

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–Ω—Å–æ–ª–∏**
   - –¢–∞–º –≥–¥–µ –≤—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ `python run_api_no_reload.py`

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–ø—Ä–æ—Å –¥–æ—à–µ–ª –¥–æ API**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä DevTools (F12)
   - –í–∫–ª–∞–¥–∫–∞ Network
   - –ò—â–∏—Ç–µ POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/search/`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Status = 200

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API –Ω–µ —É–ø–∞–ª**
   - –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Application startup complete"
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: `curl http://localhost:8000/health`

## –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ curl

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ –ë–ï–ó —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

```bash
curl -X POST "http://localhost:8000/api/search/" \
     -H "Content-Type: application/json" \
     -d "{\"query\": \"test\", \"top_k\": 3}"
```

–°—Ä–∞–∑—É –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å API - —Ç–∞–º –±—É–¥—É—Ç –≤—Å–µ –ª–æ–≥–∏!

## –†–µ–∑—é–º–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API (Ctrl+C)         ‚îÇ
‚îÇ 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ run_api_no_reload.py  ‚îÇ
‚îÇ 3. –î–æ–∂–¥–∏—Ç–µ—Å—å "startup complete"     ‚îÇ
‚îÇ 4. –°–¥–µ–ª–∞–π—Ç–µ –ø–æ–∏—Å–∫                    ‚îÇ
‚îÇ 5. –°–ú–û–¢–†–ò–¢–ï –í –ö–û–ù–°–û–õ–¨ API            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–õ–æ–≥–∏ –ù–ï –ø–æ—è–≤–ª—è—é—Ç—Å—è –∑–¥–µ—Å—å –≤ —á–∞—Ç–µ - –æ–Ω–∏ –≤ –í–ê–®–ï–ô –∫–æ–Ω—Å–æ–ª–∏!**

## –°—Ç–∞—Ç—É—Å

- ‚úÖ –ö–æ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ —ç—Ç–∞–ø—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∫–æ—Ä—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (100% –≤–º–µ—Å—Ç–æ 65%)
- ‚úÖ –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –±–µ–∑ reload –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤
- ‚úÖ –ë–µ–∑ emoji (—Ç–æ–ª—å–∫–æ ASCII)

–¢–µ–ø–µ—Ä—å –∫–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ API –∏ —Å–¥–µ–ª–∞–µ—Ç–µ –ø–æ–∏—Å–∫, –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞!
